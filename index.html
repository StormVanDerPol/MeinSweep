<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>example</title><style>body{color:azure;background-color:#000}#grid{background-color:#2f4f4f;margin:16px auto;position:relative}</style></head><body> <button id="reset-button">Reset</button> <div id="status-label"></div> <label for="size">size</label> <input id="size" type="number" placeholder="size" value="10"> <label for="amount">Amount of mines</label> <input id="amount" type="number" placeholder="amount" value="10"> <div id="grid"></div> </body><script type="module">class e{hasMine=!1;neighbouringMines=0;neighbours=[];isExplored=!1;isFlagged=!1;isExploded=!1;onUpdate=null;constructor(e,t){this.id=e;const{x:i,y:s}=t.getCartesian(e);this.x=i,this.y=s}placeMine(){this.hasMine=!0}incrementNeighbouringMines(){return++this.neighbouringMines}setNeighbours(e){this.neighbours=e}explore(){this.isExplored=!0,this.isChecked=!0,this.onUpdate&&this.onUpdate()}toggleFlag(){this.isFlagged=!this.isFlagged,this.onUpdate&&this.onUpdate()}}var t=class{size=0;mineAmount=0;field=new Map;startTime=1/0;endTime=1/0;onStart=null;onWin=null;onLose=null;gameStates=Object.freeze({progress:0,win:1,lose:2});state=this.gameStates.progress;start(e,t){this.startTime=Date.now(),this.size=e,this.mineAmount=t,this.state=this.gameStates.progress,this.createField(),this.populateMines(),this.onStart&&this.onStart()}getCartesian(e){return function(e,t){return{x:e%t,y:Math.floor(e/t)}}(e,this.size)}getOneDimensional(e,t){return function(e,t,i){return e+i*t}(e,t,this.size)}createField(){this.field=new Map;for(let t=0;t<Math.pow(this.size,2);t++)this.field.set(t,new e(t,this));this.field.forEach((e=>{const t=this.getNeighbors(e);e.setNeighbours(t)}))}getNeighbors(e){const{x:t,y:i}=e;return[{x:t-1,y:i+1},{x:t+1,y:i+1},{x:t-1,y:i-1},{x:t+1,y:i-1},{x:t,y:i+1},{x:t,y:i-1},{x:t-1,y:i},{x:t+1,y:i}].filter((({x:e,y:t})=>e>=0&&e<this.size&&t>=0&&t<this.size)).map((e=>this.getTile(e)))}populateMines(){const e=10*Math.pow(this.size,2);let t=0,i=0;for(;i<this.mineAmount;){if(t>e)throw new Error("Exceeded iteration depth");t++;const s=Math.round(Math.pow(this.size,2)*Math.random()),n=this.field.get(s);n&&(n.hasMine||(n.placeMine(),n.neighbours.forEach((e=>e.incrementNeighbouringMines())),i++))}}getTile(e){return this.field.get("object"==typeof e?this.getOneDimensional(e.x,e.y):e)}revealMines(){this.field.forEach((e=>e.hasMine&&e.explore()))}lose(){this.state=this.gameStates.lose,this.revealMines(),this.endTime=Date.now(),this.onLose&&this.onLose()}win(){this.state=this.gameStates.win,this.revealMines(),this.endTime=Date.now(),this.onWin&&this.onWin()}check(e){const t=[this.getTile(e)],i=()=>{const e=t.pop();e.explore(),0===e.neighbouringMines&&e.neighbours.forEach((e=>{e.isExplored||t.push(e)}))};for(;t.length>0;)i()}toggleFlag(e){if(this.state!==this.gameStates.progress)return;this.getTile(e).toggleFlag()}checkWinCondition(){return Array.from(this.field.entries()).filter((([,e])=>e.isExplored)).length===Math.pow(this.size,2)-this.mineAmount}discover(e){if(this.state!==this.gameStates.progress)return;const t=this.getTile(e);if(t.hasMine)return t.isExploded=!0,void this.lose();this.check(t.id),this.checkWinCondition()&&this.win()}};const i=document.getElementById("grid"),s=document.getElementById("status-label"),n=new t;n.onStart=()=>{i.innerHTML="",s.innerText=" ";const e=32*n.size,t=e/n.size;i.style.width=`${e}px`,i.style.height=`${e}px`;const o=Object.freeze({0:"initial",1:"blue",2:"green",3:"yellow",4:"tomato",5:"red",6:"darkred",7:"purple",8:"black"});n.field.forEach((e=>{const s=document.createElement("button");s.style.boxSizing="border-box",s.style.width=`${t}px`,s.style.height=`${t}px`,s.style.display="inline-block",s.style.position="absolute",s.style.left=t*e.x+"px",s.style.top=t*e.y+"px";e.onUpdate=()=>{e.isExplored?(s.style.backgroundColor="lightgray",e.hasMine?(s.innerText="💣",e.isExploded&&(s.innerText="💥")):e.neighbouringMines&&(s.innerText=e.neighbouringMines,s.style.color=o[e.neighbouringMines])):e.isFlagged&&(s.innerText="🏳️‍⚧️")};s.addEventListener("click",(()=>{n.discover(e.id)})),s.addEventListener("contextmenu",(t=>{t.preventDefault(),n.toggleFlag(e.id)})),i.append(s)}))},n.onWin=()=>s.innerText="win!",n.onLose=()=>s.innerText="lost!";const o=document.getElementById("size"),r=document.getElementById("amount");let h=Number(o.getAttribute("value")),l=Number(r.getAttribute("value"));o.addEventListener("change",(e=>h=Number(e.target.value))),r.addEventListener("change",(e=>l=Number(e.target.value)));const a=()=>{n.start(h,l)};a(),document.getElementById("reset-button").addEventListener("click",a),console.log("'Ello 🕺");</script></html>